<div class="surface-card shadow-2 border-round p-3">
  <!-- Encabezado -->
  <div class="text-center mb-3">
    <div class="text-3xl font-bold text-900">Resumen de Solicitud</div>
    <div class="text-500">Revise la información antes de guardar la solicitud</div>
    <p-divider styleClass="my-2"></p-divider>
  </div>

  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="!fichaTrabajo?.cliente && !solicitud?.monto" class="p-3 bg-yellow-50 border-round text-center mb-3">
    <i class="pi pi-info-circle text-yellow-500 text-2xl mb-2 block"></i>
    <div class="text-xl font-medium text-yellow-700 mb-1">No hay datos disponibles</div>
    <div class="text-yellow-600">
      No se encontraron datos para mostrar en el resumen. Por favor, complete los formularios en las pestañas anteriores.
    </div>
  </div>

  <!-- Grid principal de 2 columnas usando Flexbox -->
  <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
    <!-- Columna 1 -->
    <div style="flex: 1; min-width: 300px;">
      <!-- Información General -->
      <p-panel header="Información General" [toggleable]="true" styleClass="mb-2" *ngIf="solicitud">
        <ng-template pTemplate="icons">
          <i class="pi pi-file-edit text-primary mr-2"></i>
        </ng-template>
        <!-- Contenido de datos organizado en columnas -->
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
          <!-- Columna 1 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="solicitud?.n_credito" class="mb-2">
              <div class="text-500 font-medium mb-1">Número de Crédito</div>
              <div class="text-900">{{ solicitud.n_credito }}</div>
            </div>
            <div *ngIf="solicitud?.fecha" class="mb-2">
              <div class="text-500 font-medium mb-1">Fecha</div>
              <div class="text-900">{{ formatoFecha(solicitud.fecha) }}</div>
            </div>
            <div *ngIf="solicitud?.periodo" class="mb-2">
              <div class="text-500 font-medium mb-1">Periodo</div>
              <div class="text-900">{{ solicitud.periodo?.descripcion || solicitud.periodo }}</div>
            </div>
            <div *ngIf="solicitud?.tasa" class="mb-2">
              <div class="text-500 font-medium mb-1">Tasa</div>
              <div class="text-900">{{ solicitud.tasa }}%</div>
            </div>
          </div>

          <!-- Columna 2 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="solicitud?.monto" class="mb-2">
              <div class="text-500 font-medium mb-1">Monto</div>
              <div class="text-900 font-bold text-primary">{{ formatoMoneda(solicitud.monto) }}</div>
            </div>
            <div *ngIf="solicitud?.plazo" class="mb-2">
              <div class="text-500 font-medium mb-1">Plazo</div>
              <div class="text-900">{{ solicitud.plazo }}</div>
            </div>
            <div *ngIf="solicitud?.cuota" class="mb-2">
              <div class="text-500 font-medium mb-1">Cuota</div>
              <div class="text-900 font-bold text-primary">{{ formatoMoneda(solicitud.cuota) }}</div>
            </div>
          </div>
        </div>
      </p-panel>

      <!-- Datos del Cliente -->
      <p-panel header="Datos del Cliente" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.cliente">
        <ng-template pTemplate="icons">
          <i class="pi pi-user text-primary mr-2"></i>
        </ng-template>
        <!-- Contenido de datos organizado en columnas -->
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
          <!-- Columna 1 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.cliente.nombres || fichaTrabajo.cliente.apellidos" class="mb-2">
              <div class="text-500 font-medium mb-1">Nombre Completo</div>
              <div class="text-900">{{ fichaTrabajo.cliente.nombres }} {{ fichaTrabajo.cliente.apellidos }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.dni" class="mb-2">
              <div class="text-500 font-medium mb-1">DNI</div>
              <div class="text-900">{{ fichaTrabajo.cliente.dni }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.celular" class="mb-2">
              <div class="text-500 font-medium mb-1">Teléfono</div>
              <div class="text-900">{{ fichaTrabajo.cliente.celular }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.fecha_nacimiento || fichaTrabajo.cliente.fecha_born" class="mb-2">
              <div class="text-500 font-medium mb-1">Fecha de Nacimiento</div>
              <div class="text-900">{{ formatoFecha(fichaTrabajo.cliente.fecha_nacimiento || fichaTrabajo.cliente.fecha_born) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.edad" class="mb-2">
              <div class="text-500 font-medium mb-1">Edad</div>
              <div class="text-900">{{ fichaTrabajo.cliente.edad }} años</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.estado_civil" class="mb-2">
              <div class="text-500 font-medium mb-1">Estado Civil</div>
              <div class="text-900">{{ fichaTrabajo.cliente.estado_civil }}</div>
            </div>
          </div>

          <!-- Columna 2 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.cliente.direccion" class="mb-2">
              <div class="text-500 font-medium mb-1">Dirección</div>
              <div class="text-900">{{ fichaTrabajo.cliente.direccion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.genero" class="mb-2">
              <div class="text-500 font-medium mb-1">Género</div>
              <div class="text-900">{{ fichaTrabajo.cliente.genero }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.grado_instruccion" class="mb-2">
              <div class="text-500 font-medium mb-1">Grado de Instrucción</div>
              <div class="text-900">{{ fichaTrabajo.cliente.grado_instruccion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.email" class="mb-2">
              <div class="text-500 font-medium mb-1">Email</div>
              <div class="text-900">{{ fichaTrabajo.cliente.email }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.n_referencial" class="mb-2">
              <div class="text-500 font-medium mb-1">Telf Referencial</div>
              <div class="text-900">{{ fichaTrabajo.cliente.n_referencial }}</div>
            </div>
            <div *ngIf="fichaTrabajo.cliente.tipo_vivienda?.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Tipo de Vivienda</div>
              <div class="text-900">{{ fichaTrabajo.cliente.tipo_vivienda.descripcion }}</div>
            </div>
          </div>
        </div>
      </p-panel>
<!-- Datos del Aval -->
<p-panel header="Datos del Aval" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.aval">
  <ng-template pTemplate="icons">
    <i class="pi pi-shield text-primary mr-2"></i>
  </ng-template>
  <div *ngIf="fichaTrabajo.aval.omitido" class="p-message p-message-info p-2 mb-2">
    <i class="pi pi-info-circle p-message-icon"></i>
    <span class="p-message-text">Aval omitido: {{ fichaTrabajo.aval.motivo }}</span>
  </div>
  <div *ngIf="!fichaTrabajo.aval.omitido">
    <!-- Contenido de datos organizado en columnas -->
    <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
      <!-- Columna 1 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.aval.nombres || fichaTrabajo.aval.apellidos" class="mb-2">
          <div class="text-500 font-medium mb-1">Nombre Completo</div>
          <div class="text-900">{{ fichaTrabajo.aval.nombres }} {{ fichaTrabajo.aval.apellidos }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.dni" class="mb-2">
          <div class="text-500 font-medium mb-1">DNI</div>
          <div class="text-900">{{ fichaTrabajo.aval.dni }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.celular" class="mb-2">
          <div class="text-500 font-medium mb-1">Celular</div>
          <div class="text-900">{{ fichaTrabajo.aval.celular }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.n_referencial" class="mb-2">
          <div class="text-500 font-medium mb-1">Telf. Referencial</div>
          <div class="text-900">{{ fichaTrabajo.aval.n_referencial }}</div>
        </div>
      </div>

      <!-- Columna 2 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.aval.direccion" class="mb-2">
          <div class="text-500 font-medium mb-1">Dirección</div>
          <div class="text-900">{{ fichaTrabajo.aval.direccion }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.actividad" class="mb-2">
          <div class="text-500 font-medium mb-1">Actividad</div>
          <div class="text-900">{{ fichaTrabajo.aval.actividad }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.parentesco" class="mb-2">
          <div class="text-500 font-medium mb-1">Parentesco</div>
          <div class="text-900">{{ fichaTrabajo.aval.parentesco }}</div>
        </div>
        <div *ngIf="fichaTrabajo.aval.tipo_vivienda?.descripcion" class="mb-2">
          <div class="text-500 font-medium mb-1">Tipo de Vivienda</div>
          <div class="text-900">{{ fichaTrabajo.aval.tipo_vivienda.descripcion }}</div>
        </div>
      </div>
    </div>
  </div>
</p-panel>

<!-- Datos del Cónyuge -->
<p-panel header="Datos del Cónyuge" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.conyuge">
  <ng-template pTemplate="icons">
    <i class="pi pi-heart text-primary mr-2"></i>
  </ng-template>
  <div *ngIf="fichaTrabajo.conyuge.omitido" class="p-message p-message-info p-2 mb-2">
    <i class="pi pi-info-circle p-message-icon"></i>
    <span class="p-message-text">Cónyuge omitido: {{ fichaTrabajo.conyuge.motivo }}</span>
  </div>
  <div *ngIf="!fichaTrabajo.conyuge.omitido">
    <!-- Contenido de datos organizado en columnas -->
    <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
      <!-- Columna 1 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.conyuge.nombres || fichaTrabajo.conyuge.apellidos" class="mb-2">
          <div class="text-500 font-medium mb-1">Nombre Completo</div>
          <div class="text-900">{{ fichaTrabajo.conyuge.nombres }} {{ fichaTrabajo.conyuge.apellidos }}</div>
        </div>
        <div *ngIf="fichaTrabajo.conyuge.dni" class="mb-2">
          <div class="text-500 font-medium mb-1">DNI</div>
          <div class="text-900">{{ fichaTrabajo.conyuge.dni }}</div>
        </div>
      </div>

      <!-- Columna 2 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.conyuge.celular" class="mb-2">
          <div class="text-500 font-medium mb-1">Teléfono</div>
          <div class="text-900">{{ fichaTrabajo.conyuge.celular }}</div>
        </div>
        <div *ngIf="fichaTrabajo.conyuge.actividad" class="mb-2">
          <div class="text-500 font-medium mb-1">Actividad</div>
          <div class="text-900">{{ fichaTrabajo.conyuge.actividad }}</div>
        </div>
      </div>
    </div>
  </div>
</p-panel>

    </div>

    <!-- Columna 2 -->
    <div style="flex: 1; min-width: 300px;">
      <!-- Ingreso Adicional -->
      <p-panel header="Ingreso Adicional" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.ingreso_adicional">
        <ng-template pTemplate="icons">
          <i class="pi pi-dollar text-primary mr-2"></i>
        </ng-template>
        <div *ngIf="fichaTrabajo.ingreso_adicional.omitido" class="p-message p-message-info p-2 mb-2">
          <i class="pi pi-info-circle p-message-icon"></i>
          <span class="p-message-text">Ingreso adicional omitido</span>
        </div>
        <div *ngIf="!fichaTrabajo.ingreso_adicional.omitido">
          <!-- Contenido de datos organizado en columnas -->
          <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
            <!-- Columna 1 -->
            <div style="flex: 1; min-width: 200px;">
              <div *ngIf="fichaTrabajo.ingreso_adicional.actividad" class="mb-2">
                <div class="text-500 font-medium mb-1">Actividad</div>
                <div class="text-900">{{ fichaTrabajo.ingreso_adicional.actividad }}</div>
              </div>
              <div *ngIf="fichaTrabajo.ingreso_adicional.importe_act !== undefined" class="mb-2">
                <div class="text-500 font-medium mb-1">Importe</div>
                <div class="text-900 font-bold text-primary">{{ formatoMoneda(fichaTrabajo.ingreso_adicional.importe_act) }}</div>
              </div>
              <div *ngIf="fichaTrabajo.ingreso_adicional.frecuencia" class="mb-2">
                <div class="text-500 font-medium mb-1">Frecuencia</div>
                <div class="text-900">{{ fichaTrabajo.ingreso_adicional.frecuencia }}</div>
              </div>
              <div *ngIf="fichaTrabajo.ingreso_adicional.sustentable !== undefined" class="mb-2">
                <div class="text-500 font-medium mb-1">Sustentable</div>
                <div class="text-900">{{ fichaTrabajo.ingreso_adicional.sustentable ? 'Sí' : 'No' }}</div>
              </div>
            </div>

            <!-- Columna 2 -->
            <div style="flex: 1; min-width: 200px;">
              <div *ngIf="fichaTrabajo.ingreso_adicional.detalle" class="mb-2">
                <div class="text-500 font-medium mb-1">Detalle</div>
                <div class="text-900">{{ fichaTrabajo.ingreso_adicional.detalle }}</div>
              </div>

              <!-- Información de Aporte de Terceros -->
              <div *ngIf="fichaTrabajo.ingreso_adicional.aportante?.descripcion || fichaTrabajo.ingreso_adicional.importe_tercero" class="mb-2">
                <p-tag severity="info" value="Aporte de Terceros" styleClass="mb-2"></p-tag>
                <div *ngIf="fichaTrabajo.ingreso_adicional.aportante?.descripcion" class="mb-1">
                  <div class="text-500 font-medium mb-1">Aportante</div>
                  <div class="text-900">{{ fichaTrabajo.ingreso_adicional.aportante.descripcion }}</div>
                </div>
                <div *ngIf="fichaTrabajo.ingreso_adicional.importe_tercero !== undefined" class="mb-1">
                  <div class="text-500 font-medium mb-1">Importe</div>
                  <div class="text-900 font-bold text-primary">{{ formatoMoneda(fichaTrabajo.ingreso_adicional.importe_tercero) }}</div>
                </div>
                <div *ngIf="fichaTrabajo.ingreso_adicional.motivo" class="mb-1">
                  <div class="text-500 font-medium mb-1">Motivo</div>
                  <div class="text-900">{{ fichaTrabajo.ingreso_adicional.motivo }}</div>
                </div>
              </div>

              <!-- Información de Firmas -->
              <div *ngIf="fichaTrabajo.ingreso_adicional.firma_aval !== undefined || fichaTrabajo.ingreso_adicional.firma_conyuge !== undefined" class="mb-2">
                <p-tag severity="info" value="Firmas" styleClass="mb-2"></p-tag>
                <div *ngIf="fichaTrabajo.ingreso_adicional.firma_aval !== undefined" class="mb-1">
                  <div class="text-500 font-medium mb-1">Firma del Aval</div>
                  <div class="text-900">{{ fichaTrabajo.ingreso_adicional.firma_aval ? 'Sí' : 'No' }}</div>
                </div>
                <div *ngIf="fichaTrabajo.ingreso_adicional.firma_conyuge !== undefined" class="mb-1">
                  <div class="text-500 font-medium mb-1">Firma del Cónyuge</div>
                  <div class="text-900">{{ fichaTrabajo.ingreso_adicional.firma_conyuge ? 'Sí' : 'No' }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </p-panel>

      <!-- Crédito Anterior -->
      <p-panel header="Crédito Anterior" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.credito_anterior && (fichaTrabajo.credito_anterior.monto || fichaTrabajo.credito_anterior.saldo || fichaTrabajo.credito_anterior.estado)">
        <ng-template pTemplate="icons">
          <i class="pi pi-history text-primary mr-2"></i>
        </ng-template>
        <!-- Contenido de datos organizado en columnas -->
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
          <!-- Columna 1 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.credito_anterior.monto" class="mb-2">
              <div class="text-500 font-medium mb-1">Monto</div>
              <div class="text-900 font-bold text-primary">{{ formatoMoneda(fichaTrabajo.credito_anterior.monto) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.credito_anterior.saldo" class="mb-2">
              <div class="text-500 font-medium mb-1">Saldo</div>
              <div class="text-900">{{ formatoMoneda(fichaTrabajo.credito_anterior.saldo) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.credito_anterior.estado" class="mb-2">
              <div class="text-500 font-medium mb-1">Estado</div>
              <div class="text-900">{{ fichaTrabajo.credito_anterior.estado }}</div>
            </div>
          </div>

          <!-- Columna 2 -->
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.credito_anterior.tasa?.porcentaje" class="mb-2">
              <div class="text-500 font-medium mb-1">Tasa</div>
              <div class="text-900">{{ fichaTrabajo.credito_anterior.tasa.porcentaje }}%</div>
            </div>
            <div *ngIf="fichaTrabajo.credito_anterior.periodo?.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Periodo</div>
              <div class="text-900">{{ fichaTrabajo.credito_anterior.periodo.descripcion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.credito_anterior.cuotas_pagadas !== undefined || fichaTrabajo.credito_anterior.cuotas_totales !== undefined" class="mb-2">
              <div class="text-500 font-medium mb-1">Cuotas</div>
              <div class="text-900">{{ fichaTrabajo.credito_anterior.cuotas_pagadas || 0 }} / {{ fichaTrabajo.credito_anterior.cuotas_totales || 0 }}</div>
            </div>
          </div>
        </div>
      </p-panel>

      <!-- Puntaje Experian -->
      <p-panel header="Puntaje Experian" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel">
        <ng-template pTemplate="icons">
          <i class="pi pi-chart-line text-primary mr-2"></i>
        </ng-template>
        <div class="text-center py-2">
          <div class="text-5xl font-bold mb-2" [ngClass]="{
            'text-green-600': (fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel) >= 598,
            'text-yellow-600': (fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel) >= 147 && (fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel) < 598,
            'text-red-600': (fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel) < 147
          }">{{ fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel }}</div>
          <p-tag [severity]="getSeveridadPuntaje(fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel)" [value]="getNombreRangoPuntaje(fichaTrabajo?.puntaje_sentinel || solicitud?.puntaje_sentinel)"></p-tag>
        </div>
      </p-panel>
    </div>
  </div>

  <!-- Actividad Económica - Ancho completo -->
  <p-panel header="Actividad Económica" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.detalleEconomico">
    <ng-template pTemplate="icons">
      <i class="pi pi-briefcase text-primary mr-2"></i>
    </ng-template>

    <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
      <!-- Sección de Negocio -->
      <div style="flex: 1; min-width: 300px;" *ngIf="fichaTrabajo.detalleEconomico.negocio">
        <p-tag severity="info" value="Tipo de Actividad: Negocio" styleClass="mb-2 block"></p-tag>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.actividad_economica?.sector_economico?.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Sector económico</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.negocio.actividad_economica.sector_economico.descripcion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.actividad_economica?.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Actividad</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.negocio.actividad_economica.descripcion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.tiempo_valor && fichaTrabajo.detalleEconomico.negocio.tiempo.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Tiempo de Trabajo</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.negocio.tiempo_valor }} {{ fichaTrabajo.detalleEconomico.negocio.tiempo.descripcion }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.direccion" class="mb-2">
              <div class="text-500 font-medium mb-1">Dirección</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.negocio.direccion }}</div>
            </div>
          </div>
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.registro_ventas?.ventas_normales" class="mb-2">
              <div class="text-500 font-medium mb-1">Ventas Normales</div>
              <div class="text-900 font-bold text-primary">{{ formatoMoneda(fichaTrabajo.detalleEconomico.negocio.registro_ventas.ventas_normales) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.registro_ventas?.ventas_bajas" class="mb-2">
              <div class="text-500 font-medium mb-1">Ventas Bajas</div>
              <div class="text-900">{{ formatoMoneda(fichaTrabajo.detalleEconomico.negocio.registro_ventas.ventas_bajas) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.negocio.registro_ventas?.ventas_altas" class="mb-2">
              <div class="text-500 font-medium mb-1">Ventas Altas</div>
              <div class="text-900">{{ formatoMoneda(fichaTrabajo.detalleEconomico.negocio.registro_ventas.ventas_altas) }}</div>
            </div>
          </div>
        </div>

        <!-- Gastos Operativos -->
        <div class="mt-3" *ngIf="fichaTrabajo.detalleEconomico.negocio">
          <p-tag severity="info" value="Gastos Operativos" styleClass="mb-2"></p-tag>

          <!-- Mensaje cuando no hay gastos operativos -->
          <div *ngIf="!fichaTrabajo.detalleEconomico.negocio.gastos_operativos || fichaTrabajo.detalleEconomico.negocio.gastos_operativos.length === 0"
               class="p-3 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700 mb-2">
            <div class="flex items-center">
              <i class="pi pi-info-circle mr-2 text-yellow-500"></i>
              <span>No se registraron gastos operativos para este negocio</span>
            </div>
          </div>

          <!-- Tabla de gastos operativos -->
          <div *ngIf="fichaTrabajo.detalleEconomico.negocio.gastos_operativos?.length > 0">
            <p-table [value]="fichaTrabajo.detalleEconomico.negocio.gastos_operativos"
                     styleClass="p-datatable-sm"
                     [tableStyle]="{'min-width': '100%'}">
              <ng-template pTemplate="header">
                <tr>
                  <th style="width: 35%">Denominación</th>
                  <th style="width: 15%">Importe</th>
                  <th style="width: 10%">Cantidad</th>
                  <th style="width: 25%">Detalle</th>
                  <th style="width: 15%">Total</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-gastos>
                <tr>
                  <td>{{ gastos.denominacion?.descripcion }}</td>
                  <td>{{ formatoMoneda(gastos.importe) }}</td>
                  <td>{{ gastos.cantidad }}</td>
                  <td>{{ gastos.detalle || 'Sin detalle' }}</td>
                  <td class="font-bold">{{ formatoMoneda((gastos.cantidad || 0) * (gastos.importe || 0)) }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="footer">
                <tr>
                  <td colspan="4" class="text-right font-bold">Total General:</td>
                  <td class="font-bold text-primary text-lg">
                    {{ formatoMoneda(calcularTotalGastosOperativos(fichaTrabajo.detalleEconomico.negocio.gastos_operativos)) }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>

      <!-- Sección de Ingreso Dependiente -->
      <div style="flex: 1; min-width: 300px;" *ngIf="fichaTrabajo.detalleEconomico.ingreso_dependiente">
        <p-tag severity="info" value="Tipo de Actividad: Ingreso Dependiente" styleClass="mb-2 block"></p-tag>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.detalleEconomico.ingreso_dependiente.actividad" class="mb-2">
              <div class="text-500 font-medium mb-1">Actividad</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.ingreso_dependiente.actividad }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.ingreso_dependiente.frecuencia" class="mb-2">
              <div class="text-500 font-medium mb-1">Frecuencia</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.ingreso_dependiente.frecuencia }}</div>
            </div>
          </div>
          <div style="flex: 1; min-width: 200px;">
            <div *ngIf="fichaTrabajo.detalleEconomico.ingreso_dependiente.importe" class="mb-2">
              <div class="text-500 font-medium mb-1">Importe</div>
              <div class="text-900 font-bold text-primary">{{ formatoMoneda(fichaTrabajo.detalleEconomico.ingreso_dependiente.importe) }}</div>
            </div>
            <div *ngIf="fichaTrabajo.detalleEconomico.ingreso_dependiente.tiempo_valor && fichaTrabajo.detalleEconomico.ingreso_dependiente.tiempo.descripcion" class="mb-2">
              <div class="text-500 font-medium mb-1">Tiempo de Trabajo</div>
              <div class="text-900">{{ fichaTrabajo.detalleEconomico.ingreso_dependiente.tiempo_valor }} {{ fichaTrabajo.detalleEconomico.ingreso_dependiente.tiempo.descripcion }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </p-panel>

  <!-- Gastos Financieros - Ancho completo -->
  <p-panel header="Gastos Financieros" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.gasto_financieros">
    <ng-template pTemplate="icons">
      <i class="pi pi-credit-card text-primary mr-2"></i>
    </ng-template>
    <div *ngIf="fichaTrabajo.gasto_financieros.length === 0" class="p-message p-message-info p-2 mb-2">
      <i class="pi pi-info-circle p-message-icon"></i>
      <span class="p-message-text">No se registraron gastos financieros</span>
    </div>
    <div *ngIf="fichaTrabajo.gasto_financieros.length > 0">
      <p-table [value]="fichaTrabajo.gasto_financieros" styleClass="p-datatable-sm" [tableStyle]="{'min-width': '100%'}">
        <ng-template pTemplate="header">
          <tr>
            <th>Entidad</th>
            <th>Monto del crédito</th>
            <th>N° Pagadas</th>
            <th>Total pagadas</th>
            <th>Periodo</th>
            <th>Monto de cuota</th>
            <th>Saldo</th>
            <th>Tarjeta</th>
            <th>Comentario</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-gasto>
          <tr>
            <td>{{ gasto.institucion }}</td>
            <td>{{ formatoMoneda(gasto.monto_credito) }}</td>
            <td>{{ gasto.n_pagadas }}</td>
            <td>{{ gasto.n_total }}</td>
            <td>{{ gasto.periodo.descripcion }}</td>
            <td>{{ formatoMoneda(gasto.monto_cuota) }}</td>
            <td>{{ formatoMoneda(gasto.saldo_credito) }}</td>
            <td>{{ gasto.tarjeta ? 'Sí' : 'No' }}</td>
            <td>{{ gasto.comentario || 'Sin comentario' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-panel>

  <!-- Referencia Familiar - Ancho completo -->
  <p-panel header="Referencia Familiar" [toggleable]="true" styleClass="mb-2" *ngIf="fichaTrabajo?.referencia_familiar">
    <ng-template pTemplate="icons">
      <i class="pi pi-users text-primary mr-2"></i>
    </ng-template>
    <div *ngIf="fichaTrabajo.referencia_familiar.omitido" class="p-message p-message-info p-2 mb-2">
      <i class="pi pi-info-circle p-message-icon"></i>
      <span class="p-message-text">Referencia familiar omitida</span>
    </div>
    <div *ngIf="!fichaTrabajo.referencia_familiar.omitido" style="display: flex; flex-wrap: wrap; gap: 1rem;">
      <!-- Columna 1 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.referencia_familiar.descripcion" class="mb-2">
          <div class="text-500 font-medium mb-1">Nombre</div>
          <div class="text-900">{{ fichaTrabajo.referencia_familiar.descripcion }}</div>
        </div>
        <div *ngIf="fichaTrabajo.referencia_familiar.referencia_domicilio" class="mb-2">
          <div class="text-500 font-medium mb-1">Referencia de Domicilio</div>
          <div class="text-900">{{ fichaTrabajo.referencia_familiar.referencia_domicilio }}</div>
        </div>
      </div>

      <!-- Columna 2 -->
      <div style="flex: 1; min-width: 200px;">
        <div *ngIf="fichaTrabajo.referencia_familiar.direccion" class="mb-2">
          <div class="text-500 font-medium mb-1">Dirección</div>
          <div class="text-900">{{ fichaTrabajo.referencia_familiar.direccion }}</div>
        </div>
        <div *ngIf="fichaTrabajo.referencia_familiar.latitud && fichaTrabajo.referencia_familiar.longitud" class="mb-2">
          <div class="text-500 font-medium mb-1">Coordenadas</div>
          <div class="text-900">{{ fichaTrabajo.referencia_familiar.latitud }}, {{ fichaTrabajo.referencia_familiar.longitud }}</div>
        </div>
      </div>

      <!-- Composición Familiar - Ancho completo -->
      <div style="width: 100%;" *ngIf="getFamiliaMiembrosConHijos(fichaTrabajo.referencia_familiar.familia_miembros).length > 0" class="mt-3">
        <p-tag severity="info" value="Composición Familiar" styleClass="mb-2"></p-tag>
        <p-table [value]="getFamiliaMiembrosConHijos(fichaTrabajo.referencia_familiar.familia_miembros)"
                 styleClass="p-datatable-sm"
                 [tableStyle]="{'min-width': '100%'}">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 40%">Descripción</th>
              <th style="width: 20%">Cantidad</th>
              <th style="width: 40%">Gasto Escolar</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-miembro>
            <tr>
              <td>{{ miembro.descripcion }}</td>
              <td class="font-bold">{{ miembro.n_hijos }}</td>
              <td>
                @if (miembro.descripcion === 'Mayores'){
                  <div class="font-bold mb-2">Vive en domicilio</div>
                }
                <p-tag [severity]="miembro.condicion ? 'success' : 'danger'"
                       [value]="miembro.condicion ? 'Sí aplica' : 'No aplica'">
                </p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </p-panel>
</div>